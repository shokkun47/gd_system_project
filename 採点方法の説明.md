# ファシリテーション手法の採点方法

## 概要

システムは、GD中のユーザーの発言を分析し、5つのファシリテーション手法の実施状況を自動採点します。
各項目は1点（実施あり）または0点（実施なし）で評価され、合計5点満点です。

## 採点項目と判定基準

### 1. 目的確認（1点）

**判定基準**: GD開始時または途中で、議論の目的・ゴール・議題を明確に定義または確認する発言が1回以上あったか。

**検出方法**:
- **キーワード検出**: 以下のキーワードが発言に含まれているか
  - `ゴール`, `目的`, `議題`, `決定`, `話し合い`, `議論`, `テーマ`
- **フレーズ検出**: 以下のフレーズが発言に含まれているか
  - `について`, `を決める`, `を決定`, `について話し合`

**例**:
- ✓ "今日の議論のゴールは、売上向上施策を決定することですね"
- ✓ "まずは、このテーマについて話し合いましょう"
- ✗ "それでは始めましょう"（目的が明確でない）

---

### 2. 役割分担（1点）

**判定基準**: 「書記」「タイムキーパー」などの役割をAI参加者に割り当てる発言が1回以上あったか。

**検出方法**:
- **キーワード検出**: 以下のキーワードが発言に含まれているか
  - `書記`, `タイムキーパー`, `役割`, `分担`, `記録`
- **意図分析**: LLMによる意図分析で「役割分担」と判定されたか

**例**:
- ✓ "役割分担を決めましょう。田中さんは書記をお願いします"
- ✓ "タイムキーパーを決めましょう"
- ✗ "誰か記録してくれませんか"（役割の明確な割り当てがない）

---

### 3. 意見引き出し（1点）

**判定基準**: 特定の参加者を指名する、あるいは全員に話を振るなど、他者の意見を引き出そうとする発言が1回以上あったか。

**検出方法**:
- **キーワード検出**: 以下のキーワードが発言に含まれているか
  - `どう思いますか`, `意見`, `考え`, `どうですか`, `いかがですか`, `どうでしょうか`
- **意図分析**: LLMによる意図分析で「意見引き出し」または「特定の参加者への質問」と判定されたか

**例**:
- ✓ "佐藤さんは、この点についてどう思いますか？"
- ✓ "他の方で、違う意見を持っている人はいますか？"
- ✗ "何か意見はありますか？"（特定の参加者への指名がない場合、検出されない可能性あり）

---

### 4. 議論整理（1点）

**判定基準**: 「つまり～」「まとめると～」など、それまでの議論を要約・整理する発言が1回以上あったか。

**検出方法**:
- **キーワード検出**: 以下のキーワードが発言に含まれているか
  - `まとめ`, `つまり`, `要約`, `整理`, `まとめると`, `まとめて`
- **意図分析**: LLMによる意図分析で「要約」と判定されたか

**例**:
- ✓ "ここまでの意見をまとめると、A案とB案が出ていますね"
- ✓ "つまり、この案が最適だということですね"
- ✗ "なるほど"（要約・整理の意図が明確でない）

---

### 5. 時間管理（1点）

**判定基準**: 「あと〇分です」「時間がないので～」など、残り時間や時間配分に言及する発言が1回以上あったか。

**検出方法**:
- **キーワード検出**: 以下のキーワードが発言に含まれているか
  - `時間`, `分`, `残り`, `あと`, `残り時間`, `時間が`, `時間を`
- **フレーズ検出**: 以下のフレーズが発言に含まれているか
  - `そろそろ`, `時間がない`, `時間配分`
- **意図分析**: LLMによる意図分析で「時間管理」と判定されたか

**例**:
- ✓ "残り5分です。そろそろ意見をまとめていきましょう"
- ✓ "時間が半分過ぎました。次の議題に移りましょうか"
- ✗ "急ぎましょう"（時間への明確な言及がない）

---

## 採点の実行タイミング

1. **GD終了時**: `generate_simple_feedback_report`メソッドが呼ばれた際に自動で採点が実行されます
2. **採点対象**: `conversation_history`に保存されているユーザー（`self.username`）の発言のみが対象です
3. **システムメッセージ**: システムの発言は採点対象外です

## 採点ロジックの詳細

### 検出の優先順位

1. **意図分析（LLM）**: 可能な場合は、`_analyze_user_intent`メソッドで発言の意図を分析
2. **キーワード検出**: 意図分析が失敗した場合、またはキーワード検出と併用
3. **フレーズ検出**: 特定の項目（目的確認、時間管理）では、フレーズパターンも検出

### 採点の特徴

- **1回でも実施されていれば1点**: 各項目は、1回でも該当する発言があれば1点が付与されます
- **複数回実施しても1点**: 同じ項目を複数回実施しても、スコアは1点のままです
- **独立採点**: 各項目は独立して採点され、他の項目の有無に影響されません

## 保存形式

### Markdown形式（`{timestamp}.md`）

```markdown
## ファシリテーション手法スコア

- **目的確認**: 1点
- **役割分担**: 1点
- **意見引き出し**: 1点
- **議論整理**: 1点
- **時間管理**: 1点

**合計スコア**: 5/5点
```

### CSV形式（`{timestamp}_scores.csv`）

分析用にCSV形式でも保存されます。

| 項目 | スコア | ラウンド | ユーザー名 | 実験群/統制群 | 日時 |
|------|--------|----------|------------|---------------|------|
| 目的確認 | 1 | 1 | 嶋岡翔生 | 実験群 | 2025-12-02_13-28-55 |
| 役割分担 | 1 | 1 | 嶋岡翔生 | 実験群 | 2025-12-02_13-28-55 |
| ... | ... | ... | ... | ... | ... |
| 合計 | 5 | 1 | 嶋岡翔生 | 実験群 | 2025-12-02_13-28-55 |

## 注意事項

1. **発言の記録**: ユーザーの発言が正しく`conversation_history`に記録されている必要があります
2. **音声認識の精度**: 音声認識の精度によって、キーワードが正しく認識されない場合があります
3. **意図分析の精度**: LLMによる意図分析は、発言の文脈によっては誤判定される可能性があります
4. **キーワードの限界**: キーワード検出は、表現のバリエーションによっては検出されない場合があります

## 改善の余地

- より柔軟なキーワードマッチング（部分一致、類義語対応）
- LLMによるより詳細な意図分析
- 文脈を考慮した判定（例：「時間を確認」と「時間を管理」の区別）

